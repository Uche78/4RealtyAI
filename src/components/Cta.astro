---
// CTA section component with Modal
---
<section class="py-12 sm:py-16 md:py-20 lg:py-24 bg-[#3d5955] text-brand-primary">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
    <!-- CTA Content -->
    <div class="text-center">
      <!-- Label -->
      <p class="font-sans mb-3 sm:mb-4 text-charcoal-500 text-xs sm:text-sm tracking-wider uppercase">
        Begin Your Journey
      </p>
      
      <!-- Headline -->
      <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl tracking-tight mb-4 sm:mb-6 leading-tight px-2 sm:px-4 md:px-8 lg:px-12">
        See How AI Can Add Real Value to Your Business
      </h2>
      
      <!-- Subheadline -->
      <p class="text-sm sm:text-base md:text-lg lg:text-xl xl:text-2xl font-sans mb-6 sm:mb-8 md:mb-10 lg:mb-12 px-2 sm:px-4 md:px-8 lg:px-16 xl:px-24 2xl:px-40 max-w-4xl mx-auto leading-relaxed">
        You don't need to master AI to benefit from it, you just need the right guidance.
      </p>
      
      <!-- CTA Button that opens modal -->
      <button 
        id="openModalBtn"
        class="inline-flex items-center justify-center px-6 sm:px-8 md:px-10 lg:px-12 py-3 sm:py-4 bg-brand-primary text-brand-text rounded-full hover:border border-brand-primary hover:bg-[#3d5955] hover:text-brand-primary transition-all duration-300 text-sm sm:text-base lg:text-lg"
      >
        <span>Click here and see how it works</span>
        <svg class="w-4 h-4 sm:w-5 sm:h-5 ml-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </button>
    </div>
  </div>
</section>

<!-- Modal Overlay -->
<div id="formModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden items-center justify-center p-3 sm:p-4 md:p-6 overflow-y-auto">
  <!-- Modal Container -->
  <div class="bg-[#e7e5e0] rounded-lg w-full max-w-lg mx-auto shadow-2xl transform transition-all scale-95 opacity-0 modal-content my-auto">
    <!-- Modal Content -->
    <div class="relative p-6 sm:p-8 md:p-10">
      <!-- Close Button -->
      <button 
        id="closeModalBtn"
        class="absolute top-3 right-3 sm:top-4 sm:right-4 text-brand-text hover:text-charcoal-800 transition-colors p-2 rounded-full hover:bg-warm-200 z-10"
        aria-label="Close modal"
      >
        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <!-- Modal Header -->
      <div class="mb-6 sm:mb-8 pr-8">
        <h3 class="text-xl sm:text-2xl md:text-3xl text-brand-text font-bold mb-3 sm:mb-4 text-center">
          See how fast it works!
        </h3>
      </div>

      <!-- Form -->
      <form id="ctaForm" class="space-y-4 sm:space-y-5">
        <!-- Full Name -->
        <div>
          <label for="fullName" class="sr-only">Full Name</label>
          <input 
            type="text" 
            id="fullName"
            name="fullName"
            placeholder="Full Name"
            required
            class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-brand-primary border-2 border-transparent focus:border-brand-text focus:ring-2 focus:ring-brand-text focus:ring-opacity-50 rounded-lg text-charcoal-800 placeholder-warm-600 transition-all duration-200 text-sm sm:text-base"
          >
        </div>

        <!-- Business Email -->
        <div>
          <label for="businessEmail" class="sr-only">Business Email</label>
          <input 
            type="email" 
            id="businessEmail"
            name="businessEmail"
            placeholder="Business Email*"
            required
            class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-brand-primary border-2 border-transparent focus:border-brand-text focus:ring-2 focus:ring-brand-text focus:ring-opacity-50 rounded-lg text-charcoal-800 placeholder-warm-600 transition-all duration-200 text-sm sm:text-base"
          >
        </div>

        <!-- Phone with Country Code -->
        <div class="flex gap-2 sm:gap-3">
          <div class="w-20 sm:w-24 flex-shrink-0">
            <label for="countryCode" class="sr-only">Country Code</label>
            <select 
              name="countryCode"
              id="countryCode"
              class="w-full h-full px-2 sm:px-3 py-3 sm:py-4 bg-brand-primary border-2 border-transparent focus:border-brand-text focus:ring-2 focus:ring-brand-text focus:ring-opacity-50 rounded-lg text-charcoal-800 transition-all duration-200 text-xs sm:text-sm md:text-base appearance-none cursor-pointer"
            >
              <option value="+1">ðŸ‡¨ðŸ‡¦ +1</option>
              <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
              <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
              <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
            </select>
          </div>
          <div class="flex-1">
            <label for="phone" class="sr-only">Phone Number</label>
            <input 
              type="tel" 
              name="phone"
              id="phone"
              placeholder="Phone*"
              required
              pattern="[0-9]{10}"
              class="w-full px-4 sm:px-5 py-3 sm:py-4 bg-brand-primary border-2 border-transparent focus:border-brand-text focus:ring-2 focus:ring-brand-text focus:ring-opacity-50 rounded-lg text-charcoal-800 placeholder-warm-600 transition-all duration-200 text-sm sm:text-base"
            >
          </div>
        </div>

        <!-- Disclaimer Text -->
        <p class="text-xs sm:text-sm text-brand-text text-center leading-relaxed px-2">
          *Test calls available in US & Canada only. Sign up free. We serve customers worldwide.
        </p>

        <!-- Submit Button -->
        <button 
          type="submit"
          id="submitBtn"
          class="w-full bg-brand-text text-brand-primary px-6 py-3 sm:py-4 rounded-full font-bold hover:bg-black transition-all duration-300 text-sm sm:text-base md:text-lg shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
        >
          <span class="submit-text">Talk to AI</span>
          <span class="loading-text hidden inline-flex items-center justify-center">
            <svg class="animate-spin inline-block w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Initiating call...
          </span>
        </button>

        <!-- Privacy Links -->
        <div class="text-center text-xs sm:text-sm text-brand-text pt-2">
          <a href="/privacy" class="hover:text-charcoal-800 transition-colors underline">Privacy Policy</a>
          <span class="mx-2">|</span>
          <a href="/terms" class="hover:text-charcoal-800 transition-colors underline">Terms of Service</a>
        </div>
      </form>

      <!-- Success Message (hidden by default) -->
      <div id="successMessage" class="hidden text-center space-y-4 sm:space-y-5">
        <div class="w-14 h-14 sm:w-16 sm:h-16 bg-[#3d5955] rounded-full flex items-center justify-center mx-auto">
          <svg class="w-7 h-7 sm:w-8 sm:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
        </div>
        <h4 class="text-xl sm:text-2xl text-brand-text font-bold">Call Initiated!</h4>
        <p class="text-sm sm:text-base text-brand-text leading-relaxed px-4">
          You should receive a call from our AI agent within the next 30 seconds.
        </p>
        <p class="text-xs sm:text-sm text-brand-text px-4">
          Please answer your phone to experience how 4RealtyAI works.
        </p>
        <button 
          id="closeSuccessBtn"
          class="mt-4 sm:mt-6 bg-brand-text text-brand-primary px-6 sm:px-8 py-3 rounded-full font-bold hover:bg-black transition-all duration-300 text-sm sm:text-base"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const openModalBtn = document.getElementById('openModalBtn') as HTMLButtonElement;
    const closeModalBtn = document.getElementById('closeModalBtn') as HTMLButtonElement;
    const closeSuccessBtn = document.getElementById('closeSuccessBtn') as HTMLButtonElement;
    const formModal = document.getElementById('formModal') as HTMLDivElement;
    const ctaForm = document.getElementById('ctaForm') as HTMLFormElement;
    const submitBtn = document.getElementById('submitBtn') as HTMLButtonElement;
    const successMessage = document.getElementById('successMessage') as HTMLDivElement;

    if (!openModalBtn || !closeModalBtn || !closeSuccessBtn || !formModal || !ctaForm || !submitBtn || !successMessage) {
      console.warn('One or more CTA elements are missing from the DOM.');
      return;
    }

    const modalContent = formModal.querySelector('.modal-content') as HTMLDivElement;
    const submitText = submitBtn.querySelector('.submit-text') as HTMLElement;
    const loadingText = submitBtn.querySelector('.loading-text') as HTMLElement;

    if (!modalContent || !submitText || !loadingText) {
      console.warn('Modal content elements not found.');
      return;
    }

    // --- Open modal
    openModalBtn.addEventListener('click', function() {
      formModal.classList.remove('hidden');
      formModal.classList.add('flex');
      document.body.classList.add('overflow-hidden');
      
      setTimeout(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100');
      }, 10);
    });

    // --- Close modal helper
    function closeModal() {
      modalContent.classList.remove('scale-100', 'opacity-100');
      modalContent.classList.add('scale-95', 'opacity-0');

      setTimeout(() => {
        formModal.classList.remove('flex');
        formModal.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
        ctaForm.classList.remove('hidden');
        successMessage.classList.add('hidden');
        ctaForm.reset();
      }, 300);
    }

    closeModalBtn.addEventListener('click', closeModal);
    closeSuccessBtn.addEventListener('click', closeModal);

    formModal.addEventListener('click', function(e) {
      if (e.target === formModal) closeModal();
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !formModal.classList.contains('hidden')) closeModal();
    });

    // --- Form submission handler
    ctaForm.addEventListener('submit', async function(e) {
      e.preventDefault();

      submitBtn.disabled = true;
      submitText.classList.add('hidden');
      loadingText.classList.remove('hidden');

      const formData = new FormData(ctaForm);
      const countryCode = formData.get('countryCode') || '';
      const phone = formData.get('phone') || '';
      const fullPhoneNumber = `${countryCode}${phone}`;

      const data = {
        fullName: formData.get('fullName'),
        email: formData.get('businessEmail'),
        phone: fullPhoneNumber
      };

      try {
        const response = await fetch('/API/initiate-call', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!response.ok) throw new Error('Failed to initiate call');
        await response.json();

        ctaForm.classList.add('hidden');
        successMessage.classList.remove('hidden');
      } catch (error) {
        console.error('Error:', error);
        alert('Something went wrong. Please try again or contact us directly.');
      } finally {
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        loadingText.classList.add('hidden');
      }
    });
  });
</script>


<style>
  /* Smooth transitions for modal */
  .modal-content {
    transition: transform 0.3s ease-out, opacity 0.3s ease-out;
  }
  
  /* Prevent body scroll when modal is open */
  body.overflow-hidden {
    overflow: hidden;
    position: fixed;
    width: 100%;
  }
  
  /* Modal scrolling */
  #formModal {
    -webkit-overflow-scrolling: touch;
  }
  
  /* Custom scrollbar for modal if content overflows */
  .modal-content {
    max-height: calc(100vh - 2rem);
    overflow-y: auto;
  }
  
  @media (min-width: 640px) {
    .modal-content {
      max-height: calc(100vh - 3rem);
    }
  }
  
  .modal-content::-webkit-scrollbar {
    width: 6px;
  }
  
  .modal-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
  }
  
  .modal-content::-webkit-scrollbar-thumb {
    background: #c4b9ad;
    border-radius: 10px;
  }
  
  .modal-content::-webkit-scrollbar-thumb:hover {
    background: #b3a89c;
  }
  
  /* Loading spinner animation */
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  .animate-spin {
    animation: spin 1s linear infinite;
  }
  
  /* Ensure proper touch targets on mobile */
  @media (max-width: 640px) {
    button, input, select {
      min-height: 44px;
    }
  }
</style>
